/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 Emanuel Busk
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @author Emanuel Busk
 */ 
var Html5Sorter=function(e){function c(e,t){for(var n=0;n<e.length;n++){t(e[n])}}function h(e,t){var n=e.getAttribute("class");if(!n){return false}n=n.split(" ");if(n.indexOf(t)>-1){return true}else{return false}}function p(e,t){var n=e.getAttribute("class");if(n){n=n.split(" ");if(n.indexOf(t)===-1){n.push(t)}e.setAttribute("class",n.join(" "))}else{e.setAttribute("class",t)}}function d(e,t){var n=e.getAttribute("class");if(!n){return}n=n.split(" ");var r=n.indexOf(t);if(r>-1){n.splice(r,1);e.setAttribute("class",n)}}function v(e,t){var n=Array.prototype.slice.call(e);return n.indexOf(t)}function m(e){var t=e.attributes,n,r,i;if(t){for(n=t.length-1;n>=0;n-=1){i=t[n].name;if(typeof e[i]==="function"){e[i]=null}}}t=e.childNodes;if(t){r=t.length;for(n=0;n<r;n+=1){m(e.childNodes[n])}}}function g(e,t){var n=e;var t={tagName:n.tagName};var r=0;for(r;r<n.attributes.length;r++){t[n.attributes[r].name]=n.attributes[r].value}var i=n.children;if(i.length){t.children=[];r=0;for(r;r<i.length;r++){child=i[r];t.children[r]=g(child,t.children)}}return t}that=this;that.swapMode=false;var t=0;var n=2;var r=4;var i=8;var s=10;var o=12;var u=16;var a=18;var f=20;var l=32;that.classes={dragging:"dragging",dragover:"drag-over"};that.init=function(){if(typeof e.selector!=="string"){return}if(e.hasOwnProperty("swap")){}that.registerCallbacks();that.elementSelector=e.container;that.wrapper=document.querySelector(that.elementSelector);that.register(that.wrapper.querySelectorAll(e.selector))};that.register=function(e){c(e,function(e){e.setAttribute("draggable","true");e.addEventListener("dragstart",that.dragStart,false);e.addEventListener("dragend",that.dragEnd,false);e.addEventListener("drag",that.dragging,false);e.addEventListener("dragover",that.dragOver,false);e.addEventListener("dragleave",that.dragLeave,false);e.addEventListener("drop",that.drop,false);if(e.children.length){that.register(e.children)}})};that.registerCallbacks=function(){that.callbacks={};if(typeof e.onDrop==="function"){that.callbacks.drop=e.onDrop}if(typeof e.onDragStart==="function"){that.callbacks.dragStart=e.onDragStart}if(typeof e.onDragEnd==="function"){that.callbacks.dragEnd=e.onDragEnd}if(typeof e.onDragOver==="function"){that.callbacks.dragOver=e.onDragOver}if(typeof e.onDragLeave==="function"){that.callbacks.dragLeave=e.onDragLeave}};that.dragStart=function(e){that.startIndex=v(that.wrapper.children,e.target);that.dragElement=e.target;p(e.target,that.classes.dragging);var t=document.querySelector(that.elementSelector);var n=g(t);that.callback("dragStart",e.target,[n])};that.dragEnd=function(e){d(e.target,that.classes.dragging);that.callback("dragEnd",e.target)};that.dragOver=function(e){if(e.preventDefault){e.preventDefault()}p(e.target,that.classes.dragover);that.callback("dragOver",e.target)};that.dragLeave=function(e){d(e.target,that.classes.dragover);that.callback("dragLeave",e.target)};that.drop=function(e){d(e.target,that.classes.dragover);if(that.swapMode){that.swap(e.target)}else{that.insert(e.target)}var t=document.querySelector(that.elementSelector);var n=g(t);that.callback("drop",e.target,[n])};that.dragging=function(e){that.callback("dragging",e.target)};that.insert=function(e){var t=that.dragElement;var l=t.compareDocumentPosition(e);switch(l){case n:case i:case s:e.parentNode.insertBefore(t,e);break;case r:case o:e.parentNode.insertBefore(t,e.nextSibling);break;case u:case a:case f:default:break}that.dragElem=undefined};that.swap=function(e){var t=v(that.wrapper.children,e);var n=that.wrapper.children[that.startIndex];var r=that.startIndex;if(that.startIndex>t){r++}m(n);that.wrapper.removeChild(n);that.wrapper.insertBefore(n,that.wrapper.children[t]);m(e);that.wrapper.removeChild(e);that.wrapper.insertBefore(e,that.wrapper.children[r])};that.callback=function(e,t,n){if(that.hasOwnProperty("callbacks")){if(that.callbacks.hasOwnProperty(e)){var r=that.callbacks[e];if(typeof n==="object"){n.unshift(t);r.apply(r,n)}r(t)}}};that.init()}
