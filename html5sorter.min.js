/**
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013 Emanuel Busk
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * @author Emanuel Busk
 */ 
var Html5Sorter=function(e){function t(e,t){for(var n=0;n<e.length;n++){t(e[n])}}function n(e,t){var n=e.getAttribute("class");if(!n){return false}n=n.split(" ");if(n.indexOf(t)>-1){return true}else{return false}}function r(e,t){var n=e.getAttribute("class");if(n){n=n.split(" ");if(n.indexOf(t)===-1){n.push(t)}e.setAttribute("class",n.join(" "))}else{e.setAttribute("class",t)}}function i(e,t){var n=e.getAttribute("class");if(!n){return}n=n.split(" ");var r=n.indexOf(t);if(r>-1){n.splice(r,1);e.setAttribute("class",n.join(" "))}}function s(e,t){var n=Array.prototype.slice.call(e);return n.indexOf(t)}function o(e){var t=e.attributes,n,r,i;if(t){for(n=t.length-1;n>=0;n-=1){i=t[n].name;if(typeof e[i]==="function"){e[i]=null}}}t=e.childNodes;if(t){r=t.length;for(n=0;n<r;n+=1){o(e.childNodes[n])}}}that=this;that.swapMode=false;that.classes={dragging:"dragging",dragover:"drag-over"};that.init=function(){if(typeof e.selector!=="string"){return}if(e.hasOwnProperty("swap")){that.swapMode=e.swap}that.registerCallbacks();that.wrapper=document.querySelector(e.selector);that.register()};that.register=function(){t(that.wrapper.children,function(e){e.setAttribute("draggable","true");e.addEventListener("dragstart",that.dragStart,false);e.addEventListener("dragend",that.dragEnd,false);e.addEventListener("drag",that.dragging,false);e.addEventListener("dragover",that.dragOver,false);e.addEventListener("dragleave",that.dragLeave,false);e.addEventListener("drop",that.drop,false)})};that.registerCallbacks=function(){that.callbacks={};if(typeof e.onDrop==="function"){that.callbacks.drop=e.onDrop}if(typeof e.onDragStart==="function"){that.callbacks.dragStart=e.onDragStart}if(typeof e.onDragEnd==="function"){that.callbacks.dragEnd=e.onDragEnd}if(typeof e.onDragOver==="function"){that.callbacks.dragOver=e.onDragOver}if(typeof e.onDragLeave==="function"){that.callbacks.dragLeave=e.onDragLeave}};that.dragStart=function(e){that.startIndex=s(that.wrapper.children,e.target);r(e.target,that.classes.dragging);that.callback("dragStart",e)};that.dragEnd=function(e){i(e.target,that.classes.dragging);that.callback("dragEnd",e)};that.dragOver=function(e){if(e.preventDefault){e.preventDefault()}var t=that.findDragParent(e.target);r(t,that.classes.dragover);that.callback("dragOver",e)};that.dragLeave=function(e){var t=that.findDragParent(e.target);i(t,that.classes.dragover);that.callback("dragLeave",e)};that.drop=function(e){var t=that.findDragParent(e.target);if(e.preventDefault){e.preventDefault()}i(t,that.classes.dragover);if(that.swapMode){that.swap(t)}else{that.insert(t)}that.callback("drop",e)};that.dragging=function(e){that.callback("dragging",e)};that.findDragParent=function(e){if(e.draggable&&e.nodeName!=="IMG"){return e}while(e.parentNode){e=e.parentNode;if(e.draggable&&e.nodeName!=="IMG"){return e;break}}};that.insert=function(e){var t=s(that.wrapper.children,e);var n=that.wrapper.children[that.startIndex];o(n);that.wrapper.removeChild(n);that.wrapper.insertBefore(n,that.wrapper.children[t])};that.swap=function(e){var t=s(that.wrapper.children,e);var n=that.wrapper.children[that.startIndex];var r=that.startIndex;if(that.startIndex>t){r++}o(n);that.wrapper.removeChild(n);that.wrapper.insertBefore(n,that.wrapper.children[t]);o(e);that.wrapper.removeChild(e);that.wrapper.insertBefore(e,that.wrapper.children[r])};that.callback=function(e,t){if(that.hasOwnProperty("callbacks")){if(that.callbacks.hasOwnProperty(e)){var n=that.callbacks[e];n(t)}}};that.init()}
